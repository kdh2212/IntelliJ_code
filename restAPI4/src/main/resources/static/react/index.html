<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사용자 관리 시스템 (React)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        function UserForm({ onSubmit, initialData, onCancel }) {
            const [formData, setFormData] = React.useState({
                id: null,
                name: '',
                email: '',
                age: ''
            });

            React.useEffect(() => {
                if (initialData) {
                    setFormData(initialData);
                }
            }, [initialData]);

            const handleSubmit = (e) => {
                e.preventDefault();
                onSubmit(formData);
                setFormData({ id: null, name: '', email: '', age: '' });
            };

            const handleChange = (e) => {
                setFormData({
                    ...formData,
                    [e.target.name]: e.target.value
                });
            };

            return (
                <form onSubmit={handleSubmit} className="mb-4">
                    <input type="hidden" name="id" value={formData.id || ''} />
                    <div className="mb-3">
                        <label htmlFor="name" className="form-label">이름</label>
                        <input
                            type="text"
                            className="form-control"
                            id="name"
                            name="name"
                            value={formData.name}
                            onChange={handleChange}
                            required
                        />
                    </div>
                    <div className="mb-3">
                        <label htmlFor="email" className="form-label">이메일</label>
                        <input
                            type="email"
                            className="form-control"
                            id="email"
                            name="email"
                            value={formData.email}
                            onChange={handleChange}
                            required
                        />
                    </div>
                    <div className="mb-3">
                        <label htmlFor="age" className="form-label">나이</label>
                        <input
                            type="number"
                            className="form-control"
                            id="age"
                            name="age"
                            value={formData.age}
                            onChange={handleChange}
                            required
                        />
                    </div>
                    <button type="submit" className="btn btn-primary">저장</button>
                    <button type="button" className="btn btn-secondary ms-2" onClick={onCancel}>취소</button>
                </form>
            );
        }

        function UserList({ users, onDelete, onEdit }) {
            if (!users || users.length === 0) {
                return (
                    <div className="text-center">
                        데이터가 없습니다.
                    </div>
                );
            }

            return (
                <table className="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>이름</th>
                            <th>이메일</th>
                            <th>나이</th>
                            <th>작업</th>
                        </tr>
                    </thead>
                    <tbody>
                        {users.map(user => (
                            <tr key={user.id}>
                                <td>{user.id}</td>
                                <td>{user.name}</td>
                                <td>{user.email}</td>
                                <td>{user.age}</td>
                                <td>
                                    <button
                                        className="btn btn-sm btn-warning me-1"
                                        onClick={() => onEdit(user)}
                                    >
                                        수정
                                    </button>
                                    <button
                                        className="btn btn-sm btn-danger"
                                        onClick={() => onDelete(user.id)}
                                    >
                                        삭제
                                    </button>
                                </td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            );
        }

        function App() {
            const [users, setUsers] = React.useState([]);
            const [error, setError] = React.useState(null);
            const [editingUser, setEditingUser] = React.useState(null);

            React.useEffect(() => {
                loadUsers();
            }, []);

            const loadUsers = async () => {
                try {
                    const response = await axios.get('/api/users');
                    setUsers(response.data);
                    setError(null);
                } catch (error) {
                    setError('데이터 로딩 중 오류가 발생했습니다: ' + error.message);
                    console.error('Error loading users:', error);
                }
            };

            const handleSubmit = async (userData) => {
                try {
                    if (userData.id) {
                        await axios.put(`/api/users/${userData.id}`, {
                            ...userData,
                            age: parseInt(userData.age)
                        });
                    } else {
                        await axios.post('/api/users', {
                            ...userData,
                            age: parseInt(userData.age)
                        });
                    }
                    loadUsers();
                    setError(null);
                    setEditingUser(null);
                } catch (error) {
                    setError('저장 중 오류가 발생했습니다: ' + error.message);
                    console.error('Error saving user:', error);
                }
            };

            const handleDelete = async (id) => {
                if (window.confirm('정말 삭제하시겠습니까?')) {
                    try {
                        await axios.delete(`/api/users/${id}`);
                        loadUsers();
                        setError(null);
                    } catch (error) {
                        setError('삭제 중 오류가 발생했습니다: ' + error.message);
                        console.error('Error deleting user:', error);
                    }
                }
            };

            const handleEdit = (user) => {
                setEditingUser(user);
            };

            const handleCancel = () => {
                setEditingUser(null);
            };

            return (
                <div className="container mt-5">
                    <h2>사용자 관리 시스템 (React)</h2>
                    {error && (
                        <div className="alert alert-danger" role="alert">
                            {error}
                        </div>
                    )}
                    <UserForm 
                        onSubmit={handleSubmit} 
                        initialData={editingUser}
                        onCancel={handleCancel}
                    />
                    <UserList 
                        users={users} 
                        onDelete={handleDelete}
                        onEdit={handleEdit}
                    />
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html> 